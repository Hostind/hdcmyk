<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive UI Enhancement Integration Test</title>
    <link rel="stylesheet" href="src/css/styles.css">
    <style>
        .test-container {
            padding: 20px;
            margin: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .test-pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body style="padding-top: 0;">
    <!-- Status Bar Test -->
    <div class="status-bar visible" id="status-bar" role="banner" aria-label="Calculator status and quick actions">
        <div class="status-bar-content">
            <div class="status-info">
                <span class="status-label">Status:</span>
                <span class="status-value" id="status-value">Ready</span>
            </div>
            <div class="delta-info">
                <span class="delta-label">ΔE*ab:</span>
                <span class="delta-value" id="status-delta-value">--</span>
            </div>
            <div class="quick-actions-bar">
                <button class="status-action-btn" id="status-calculate-btn" title="Calculate color difference">
                    Calculate
                </button>
                <button class="status-action-btn" id="status-reset-btn" title="Reset all inputs">
                    Reset
                </button>
                <button class="status-action-btn" id="status-export-btn" title="Export results" disabled>
                    Export
                </button>
            </div>
        </div>
    </div>

    <div class="calculator-container" style="margin-top: 80px;">
        <header class="app-header">
            <h1>UI Enhancement Comprehensive Integration Test</h1>
            <p class="subtitle">Testing all UI enhancements with existing functionality</p>
        </header>

        <div class="test-container">
            <h2>🧪 Comprehensive UI Enhancement Tests</h2>
            <div id="test-results"></div>
            <button onclick="runAllTests()" class="btn-outlined gold-premium">Run All Tests</button>
        </div>

        <!-- Test Enhanced Tooltips -->
        <div class="test-container">
            <h3>Enhanced Tooltips Test</h3>
            <h2 class="tooltip-enhanced" 
                data-tooltip="Enter the desired color values for your target.&#10;Supports both CMYK ink percentages and LAB measurements.&#10;Use presets for common colors or input custom values.&#10;&#10;• CMYK: Industry-standard ink percentages (0-100%)&#10;• LAB: Device-independent color space values&#10;• Presets: Quick access to common printing colors" 
                tabindex="0">Target Color (Hover to test tooltip)</h2>
            
            <h2 class="tooltip-enhanced" 
                data-tooltip="Enter the measured color values from your sample.&#10;Compare against target to calculate color difference.&#10;Real-time swatch preview shows approximate color.&#10;&#10;• Measured Values: Input actual measured color data&#10;• Color Preview: Visual representation of entered values&#10;• Quick Actions: Copy, clear, and preset options available" 
                tabindex="0">Sample Color (Hover to test tooltip)</h2>
            
            <h2 class="tooltip-enhanced" 
                data-tooltip="Displays calculated color difference results.&#10;ΔE*ab shows total color difference between target and sample.&#10;Component deltas show individual L*, a*, b* differences.&#10;&#10;• ΔE*ab < 1.0: Excellent match (not perceptible)&#10;• ΔE*ab 1.0-2.0: Good match (barely perceptible)&#10;• ΔE*ab 2.0-4.0: Acceptable match (noticeable)&#10;• ΔE*ab > 4.0: Poor match (clearly visible)" 
                tabindex="0">Delta (Hover to test tooltip)</h2>
        </div>

        <!-- Test Enhanced Buttons -->
        <div class="test-container">
            <h3>Enhanced Button Styling Test</h3>
            <div style="display: flex; gap: 15px; flex-wrap: wrap; margin: 20px 0;">
                <button class="btn-outlined">Standard Outlined Button</button>
                <button class="btn-outlined gold">Gold Outlined Button</button>
                <button class="btn-outlined gold-premium">Gold Premium Button</button>
                <button class="calculate-button btn-outlined gold-premium">Calculate Button</button>
                <button class="quick-action-btn">Quick Action Button</button>
                <button class="status-action-btn">Status Action Button</button>
                <button class="export-btn btn-outlined gold">Export Button</button>
                <button class="test-btn">Test Button</button>
            </div>
        </div>

        <!-- Test Gold Accents -->
        <div class="test-container">
            <h3>Gold Accents Test</h3>
            <div class="gold-accent-showcase">
                <h4 class="gold-accent">Gold Accent Text</h4>
                <div class="premium-feature" style="display: block;">
                    <span class="premium-badge">Premium</span>
                    <span style="background: var(--gold-gradient); padding: 10px; border-radius: 4px; color: white;">Gold Gradient Background</span>
                </div>
                <div style="border: 2px solid var(--gold-primary); padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <p>Element with gold border using CSS custom property</p>
                </div>
                <div style="background: var(--gold-accent-bg); padding: 15px; border-radius: 8px; border: 1px solid var(--gold-accent-border);">
                    <p>Element with gold accent background</p>
                </div>
            </div>
        </div>

        <!-- Test Color Sections -->
        <div class="test-container">
            <h3>Integration with Existing Features</h3>
            <section class="color-section" id="target-section">
                <h2 class="tooltip-enhanced" 
                    data-tooltip="Enter the desired color values for your target.&#10;Supports both CMYK ink percentages and LAB measurements." 
                    tabindex="0">Target Color</h2>
                <div class="color-display">
                    <div class="color-swatch" id="target-swatch" aria-label="Target color preview"></div>
                    <div class="color-equation-symbol">-</div>
                </div>
                
                <div class="preset-controls">
                    <div class="preset-dropdown-container">
                        <label for="target-preset-select">Preset Colors:</label>
                        <select id="target-preset-select" class="preset-select">
                            <option value="">Select a preset color...</option>
                            <option value='{"cmyk":{"c":0,"m":0,"y":100,"k":0}}'>PANTONE Pro. Yellow</option>
                            <option value='{"cmyk":{"c":0,"m":100,"y":0,"k":0}}'>PANTONE Pro. Magenta</option>
                        </select>
                    </div>
                    <div class="quick-actions">
                        <button type="button" class="quick-action-btn" id="target-clear-btn" title="Clear all target color inputs">Clear</button>
                        <button type="button" class="quick-action-btn" id="target-copy-btn" title="Copy target CMYK values to clipboard">Copy CMYK</button>
                    </div>
                </div>
                
                <div class="input-groups">
                    <div class="input-group">
                        <label class="group-label">CMYK Values</label>
                        <div class="input-row">
                            <div class="input-field">
                                <label for="target-c">C%</label>
                                <input type="number" id="target-c" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label for="target-m">M%</label>
                                <input type="number" id="target-m" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label for="target-y">Y%</label>
                                <input type="number" id="target-y" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label for="target-k">K%</label>
                                <input type="number" id="target-k" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- PWA Test Section -->
        <div class="test-container">
            <h3>PWA Functionality Test</h3>
            <div id="pwa-test-results"></div>
            <button onclick="testPWAFeatures()" class="btn-outlined gold">Test PWA Features</button>
        </div>

        <!-- Export Feature Test -->
        <div class="test-container">
            <h3>Export Features Test</h3>
            <div class="export-panel premium">
                <h4 class="gold-accent">Export Results</h4>
                <div class="export-buttons">
                    <button class="export-btn btn-outlined gold" id="export-csv-btn">Export CSV</button>
                    <button class="export-btn btn-outlined gold-premium" id="export-pdf-btn">Export PDF</button>
                </div>
            </div>
        </div>

        <!-- G7 Analysis Test -->
        <div class="test-container">
            <h3>G7 Analysis Integration Test</h3>
            <div class="g7-analysis-container premium-feature" style="display: block;">
                <h4 class="gold-accent">G7 Gray Balance Analysis <span class="premium-badge">Premium</span></h4>
                <div class="g7-analysis-content">
                    <div class="g7-compliance-status">
                        <div class="compliance-indicator">
                            <span class="compliance-icon">⚪</span>
                            <span class="compliance-text">Test Mode</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="src/js/color-science.js"></script>
    <script src="src/js/pantone-colors.js"></script>
    <script src="test-cross-browser-ui-enhancements.js"></script>

    <script>
        // Comprehensive Integration Test Suite
        let testResults = [];

        function logTestResult(test, passed, message) {
            testResults.push({ test, passed, message, timestamp: new Date() });
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            resultDiv.innerHTML = `<strong>${passed ? '✅' : '❌'} ${test}:</strong> ${message}`;
            resultsDiv.appendChild(resultDiv);
        }

        function logTestInfo(message) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-result test-info';
            resultDiv.innerHTML = `<strong>ℹ️ Info:</strong> ${message}`;
            resultsDiv.appendChild(resultDiv);
        }

        async function runAllTests() {
            // Clear previous results
            document.getElementById('test-results').innerHTML = '';
            testResults = [];

            logTestInfo('Starting comprehensive UI enhancement integration tests...');

            // Test 1: Status Bar Functionality
            await testStatusBarIntegration();

            // Test 2: Enhanced Tooltips
            await testEnhancedTooltips();

            // Test 3: Button Styling
            await testButtonStyling();

            // Test 4: Gold Accents
            await testGoldAccents();

            // Test 5: CSS Custom Properties
            await testCSSCustomProperties();

            // Test 6: Responsive Design
            await testResponsiveDesign();

            // Test 7: Accessibility Features
            await testAccessibilityFeatures();

            // Test 8: Integration with Calculator Features
            await testCalculatorIntegration();

            // Test 9: Cross-browser compatibility
            await testCrossBrowserCompatibility();

            // Generate summary
            generateTestSummary();
        }

        async function testStatusBarIntegration() {
            logTestInfo('Testing Status Bar Integration...');

            const statusBar = document.getElementById('status-bar');
            if (statusBar) {
                logTestResult('Status Bar Exists', true, 'Status bar element found in DOM');
                
                const computedStyle = getComputedStyle(statusBar);
                const isVisible = statusBar.classList.contains('visible');
                logTestResult('Status Bar Visibility', isVisible, `Status bar visible class: ${isVisible}`);
                
                const hasGradient = computedStyle.backgroundImage.includes('gradient');
                logTestResult('Status Bar Gradient', hasGradient, `Background gradient: ${hasGradient ? 'applied' : 'missing'}`);
                
                // Test quick actions
                const quickActions = statusBar.querySelectorAll('.status-action-btn');
                logTestResult('Quick Actions', quickActions.length >= 3, `Found ${quickActions.length} quick action buttons`);
            } else {
                logTestResult('Status Bar Exists', false, 'Status bar element not found');
            }
        }

        async function testEnhancedTooltips() {
            logTestInfo('Testing Enhanced Tooltips...');

            const tooltips = document.querySelectorAll('.tooltip-enhanced');
            logTestResult('Tooltip Elements', tooltips.length > 0, `Found ${tooltips.length} enhanced tooltip elements`);

            if (tooltips.length > 0) {
                const firstTooltip = tooltips[0];
                const hasDataTooltip = firstTooltip.hasAttribute('data-tooltip');
                logTestResult('Tooltip Data Attribute', hasDataTooltip, `data-tooltip attribute: ${hasDataTooltip ? 'present' : 'missing'}`);

                const tooltipContent = firstTooltip.getAttribute('data-tooltip');
                const hasRichContent = tooltipContent && tooltipContent.length > 50;
                logTestResult('Tooltip Rich Content', hasRichContent, `Tooltip content length: ${tooltipContent ? tooltipContent.length : 0} characters`);

                // Test CSS styling
                const computedStyle = getComputedStyle(firstTooltip);
                const hasHelperCursor = computedStyle.cursor === 'help';
                logTestResult('Tooltip Cursor Style', hasHelperCursor, `Cursor style: ${computedStyle.cursor}`);
            }
        }

        async function testButtonStyling() {
            logTestInfo('Testing Enhanced Button Styling...');

            const outlinedButtons = document.querySelectorAll('.btn-outlined');
            logTestResult('Outlined Buttons', outlinedButtons.length > 0, `Found ${outlinedButtons.length} outlined buttons`);

            const goldButtons = document.querySelectorAll('.btn-outlined.gold, .btn-outlined.gold-premium');
            logTestResult('Gold Buttons', goldButtons.length > 0, `Found ${goldButtons.length} gold-styled buttons`);

            const quickActionButtons = document.querySelectorAll('.quick-action-btn');
            logTestResult('Quick Action Buttons', quickActionButtons.length > 0, `Found ${quickActionButtons.length} quick action buttons`);

            // Test button styling
            if (outlinedButtons.length > 0) {
                const button = outlinedButtons[0];
                const computedStyle = getComputedStyle(button);
                const hasBorder = computedStyle.borderWidth !== '0px';
                logTestResult('Button Border Styling', hasBorder, `Border width: ${computedStyle.borderWidth}`);

                const hasTransition = computedStyle.transition !== 'all 0s ease 0s';
                logTestResult('Button Transitions', hasTransition, `Transitions: ${hasTransition ? 'enabled' : 'disabled'}`);
            }
        }

        async function testGoldAccents() {
            logTestInfo('Testing Gold Accent System...');

            // Test CSS custom properties
            const rootStyle = getComputedStyle(document.documentElement);
            const goldPrimary = rootStyle.getPropertyValue('--gold-primary').trim();
            logTestResult('Gold CSS Variables', !!goldPrimary, `--gold-primary value: ${goldPrimary || 'not found'}`);

            const goldGradient = rootStyle.getPropertyValue('--gold-gradient').trim();
            logTestResult('Gold Gradient Variable', !!goldGradient, `--gold-gradient: ${goldGradient ? 'defined' : 'missing'}`);

            // Test premium badges
            const premiumBadges = document.querySelectorAll('.premium-badge');
            logTestResult('Premium Badges', premiumBadges.length > 0, `Found ${premiumBadges.length} premium badges`);

            // Test gold accent elements
            const goldAccentElements = document.querySelectorAll('.gold-accent');
            logTestResult('Gold Accent Elements', goldAccentElements.length > 0, `Found ${goldAccentElements.length} gold accent elements`);
        }

        async function testCSSCustomProperties() {
            logTestInfo('Testing CSS Custom Properties Support...');

            const supportsCustomProperties = CSS.supports('color', 'var(--test)');
            logTestResult('CSS Custom Properties', supportsCustomProperties, `Browser support: ${supportsCustomProperties ? 'yes' : 'no'}`);

            if (supportsCustomProperties) {
                const rootStyle = getComputedStyle(document.documentElement);
                const customProps = [
                    '--gold-primary', '--gold-light', '--gold-dark', '--gold-gradient',
                    '--gold-shadow', '--gold-accent-bg', '--gold-accent-border'
                ];

                let definedProps = 0;
                customProps.forEach(prop => {
                    const value = rootStyle.getPropertyValue(prop).trim();
                    if (value) definedProps++;
                });

                logTestResult('Gold Custom Properties', definedProps === customProps.length, `${definedProps}/${customProps.length} properties defined`);
            }
        }

        async function testResponsiveDesign() {
            logTestInfo('Testing Responsive Design...');

            const viewportMeta = document.querySelector('meta[name="viewport"]');
            logTestResult('Viewport Meta Tag', !!viewportMeta, `Viewport meta: ${viewportMeta ? 'present' : 'missing'}`);

            // Test responsive breakpoints
            const breakpoints = [
                { name: 'Mobile', query: '(max-width: 768px)' },
                { name: 'Tablet', query: '(min-width: 769px) and (max-width: 1024px)' },
                { name: 'Desktop', query: '(min-width: 1025px)' }
            ];

            let activeBreakpoint = null;
            breakpoints.forEach(bp => {
                if (window.matchMedia(bp.query).matches) {
                    activeBreakpoint = bp.name;
                }
            });

            logTestResult('Responsive Breakpoints', !!activeBreakpoint, `Active breakpoint: ${activeBreakpoint || 'unknown'}`);

            // Test body padding for status bar
            const bodyStyle = getComputedStyle(document.body);
            const hasPaddingTop = parseFloat(bodyStyle.paddingTop) > 0;
            logTestResult('Body Padding for Status Bar', hasPaddingTop, `Body padding-top: ${bodyStyle.paddingTop}`);
        }

        async function testAccessibilityFeatures() {
            logTestInfo('Testing Accessibility Features...');

            // Test ARIA labels
            const ariaLabels = document.querySelectorAll('[aria-label]');
            logTestResult('ARIA Labels', ariaLabels.length > 0, `Found ${ariaLabels.length} elements with ARIA labels`);

            // Test semantic HTML
            const semanticElements = document.querySelectorAll('main, section, header, nav, article, aside, footer');
            logTestResult('Semantic HTML', semanticElements.length > 0, `Found ${semanticElements.length} semantic elements`);

            // Test keyboard navigation
            const tabIndexElements = document.querySelectorAll('[tabindex]');
            logTestResult('Keyboard Navigation', tabIndexElements.length > 0, `Found ${tabIndexElements.length} tab-navigable elements`);

            // Test focus indicators
            const focusableElements = document.querySelectorAll('button, input, select, a, [tabindex]:not([tabindex="-1"])');
            logTestResult('Focusable Elements', focusableElements.length > 0, `Found ${focusableElements.length} focusable elements`);
        }

        async function testCalculatorIntegration() {
            logTestInfo('Testing Calculator Feature Integration...');

            // Test color sections
            const colorSections = document.querySelectorAll('.color-section');
            logTestResult('Color Sections', colorSections.length > 0, `Found ${colorSections.length} color sections`);

            // Test input fields
            const cmykInputs = document.querySelectorAll('input[id$="-c"], input[id$="-m"], input[id$="-y"], input[id$="-k"]');
            logTestResult('CMYK Input Fields', cmykInputs.length > 0, `Found ${cmykInputs.length} CMYK input fields`);

            // Test preset dropdown
            const presetSelects = document.querySelectorAll('.preset-select');
            logTestResult('Preset Dropdowns', presetSelects.length > 0, `Found ${presetSelects.length} preset dropdowns`);

            // Test if Pantone colors are loaded
            if (typeof window.pantoneColors !== 'undefined') {
                logTestResult('Pantone Colors Loaded', true, `Pantone colors array available`);
            } else {
                logTestResult('Pantone Colors Loaded', false, 'Pantone colors not found');
            }

            // Test export functionality
            const exportButtons = document.querySelectorAll('.export-btn');
            logTestResult('Export Buttons', exportButtons.length > 0, `Found ${exportButtons.length} export buttons`);

            // Test G7 analysis integration
            const g7Container = document.querySelector('.g7-analysis-container');
            logTestResult('G7 Analysis Integration', !!g7Container, `G7 analysis container: ${g7Container ? 'present' : 'missing'}`);
        }

        async function testCrossBrowserCompatibility() {
            logTestInfo('Testing Cross-Browser Compatibility...');

            if (typeof CrossBrowserUIEnhancementsTest !== 'undefined') {
                try {
                    const tester = new CrossBrowserUIEnhancementsTest();
                    const results = await tester.runCrossBrowserTests();
                    
                    logTestResult('Cross-Browser Test Suite', true, `Compatibility score: ${results.score}%`);
                    logTestResult('Browser Detection', true, `Detected: ${results.browser.name} ${results.browser.version}`);
                    logTestResult('Device Detection', true, `Device type: ${results.device.type}`);
                    
                    if (results.criticalFailures > 0) {
                        logTestResult('Critical Features', false, `${results.criticalFailures} critical features failed`);
                    } else {
                        logTestResult('Critical Features', true, 'All critical features supported');
                    }
                } catch (error) {
                    logTestResult('Cross-Browser Test Suite', false, `Test failed: ${error.message}`);
                }
            } else {
                logTestResult('Cross-Browser Test Suite', false, 'Test suite not loaded');
            }
        }

        async function testPWAFeatures() {
            const resultsDiv = document.getElementById('pwa-test-results');
            resultsDiv.innerHTML = '';

            function addPWAResult(test, passed, message) {
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
                resultDiv.innerHTML = `<strong>${passed ? '✅' : '❌'} ${test}:</strong> ${message}`;
                resultsDiv.appendChild(resultDiv);
            }

            // Test Service Worker
            if ('serviceWorker' in navigator) {
                addPWAResult('Service Worker Support', true, 'Service Worker API available');
                
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    addPWAResult('Service Worker Registration', !!registration, 
                        registration ? 'Service Worker registered' : 'Service Worker not registered');
                } catch (error) {
                    addPWAResult('Service Worker Registration', false, `Registration check failed: ${error.message}`);
                }
            } else {
                addPWAResult('Service Worker Support', false, 'Service Worker not supported');
            }

            // Test Manifest
            const manifestLink = document.querySelector('link[rel="manifest"]');
            addPWAResult('Web App Manifest', !!manifestLink, 
                manifestLink ? `Manifest linked: ${manifestLink.href}` : 'Manifest not found');

            // Test Local Storage
            try {
                localStorage.setItem('pwa-test', 'test');
                localStorage.removeItem('pwa-test');
                addPWAResult('Local Storage', true, 'Local Storage available');
            } catch (error) {
                addPWAResult('Local Storage', false, 'Local Storage not available');
            }

            // Test offline capability
            addPWAResult('Offline Status', !navigator.onLine, 
                navigator.onLine ? 'Currently online' : 'Currently offline');
        }

        function generateTestSummary() {
            logTestInfo('Test Summary Generated');
            
            const passed = testResults.filter(r => r.passed).length;
            const total = testResults.length;
            const percentage = Math.round((passed / total) * 100);
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${percentage >= 90 ? 'test-pass' : percentage >= 70 ? 'test-info' : 'test-fail'}`;
            summaryDiv.innerHTML = `
                <strong>📊 Final Test Summary:</strong><br>
                Tests Passed: ${passed}/${total} (${percentage}%)<br>
                Status: ${percentage >= 90 ? 'Excellent' : percentage >= 70 ? 'Good' : 'Needs Attention'}<br>
                Timestamp: ${new Date().toLocaleString()}
            `;
            
            document.getElementById('test-results').appendChild(summaryDiv);
            
            console.log('Comprehensive UI Enhancement Test Results:', {
                passed,
                total,
                percentage,
                details: testResults
            });
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                runAllTests();
            }, 1000);
        });

        // Test status bar visibility toggle
        function toggleStatusBar() {
            const statusBar = document.getElementById('status-bar');
            statusBar.classList.toggle('visible');
        }

        // Test status bar updates
        function updateStatusBar(status, deltaValue = '--') {
            const statusElement = document.getElementById('status-value');
            const deltaElement = document.getElementById('status-delta-value');
            
            if (statusElement) statusElement.textContent = status;
            if (deltaElement) deltaElement.textContent = deltaValue;
        }

        // Initialize status bar
        setTimeout(() => {
            updateStatusBar('Testing Mode', '2.34');
        }, 500);
    </script>
</body>
</html>