<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Test - LAB Color Calculator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="calculator-container">
        <header class="app-header">
            <h1>History Functionality Test</h1>
            <p class="subtitle">Testing local storage for color history</p>
        </header>

        <!-- Simple test interface -->
        <div class="test-section">
            <h3>Test History Functions</h3>
            <div class="test-buttons">
                <button onclick="testSaveHistory()" class="test-btn">Save Test Entry</button>
                <button onclick="testLoadHistory()" class="test-btn">Load History</button>
                <button onclick="testDisplayHistory()" class="test-btn">Display History</button>
                <button onclick="testClearHistory()" class="test-btn">Clear History</button>
                <button onclick="testHistoryStats()" class="test-btn">Show Stats</button>
            </div>
        </div>

        <!-- History display area -->
        <section class="tools-section">
            <div class="history-panel">
                <h3>Recent Comparisons</h3>
                <div class="history-list" id="history-list">
                    <!-- History items will be populated by JavaScript -->
                </div>
                <button class="clear-history-btn" id="clear-history-btn">Clear History</button>
            </div>
            
            <div class="export-panel">
                <h3>Test Results</h3>
                <div id="test-results" style="background: #f8f9fa; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 0.9rem; max-height: 200px; overflow-y: auto;">
                    Test results will appear here...
                </div>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="color-science.js"></script>
    <script src="storage.js"></script>
    
    <script>
        // Test functions
        function testSaveHistory() {
            const testComparison = {
                target: {
                    cmyk: { c: 15.2, m: 78.4, y: 65.1, k: 8.3 },
                    lab: { l: 60.87, a: 44.36, b: 35.27 }
                },
                sample: {
                    cmyk: { c: 17.8, m: 80.1, y: 63.5, k: 10.2 },
                    lab: { l: 58.72, a: 42.18, b: 36.93 }
                },
                deltaE: 3.48,
                tolerance: { zone: 'acceptable', description: 'Acceptable', range: '2.1-5.0' },
                componentDeltas: { deltaL: -2.15, deltaA: -2.18, deltaB: 1.66, deltaC: -1.23, deltaH: 0.85 },
                notes: 'Test entry ' + new Date().toLocaleTimeString()
            };
            
            const result = window.colorStorage.saveToHistory(testComparison);
            logResult('Save Test', result ? 'SUCCESS: Entry saved' : 'FAILED: Could not save');
            
            // Refresh display
            window.colorStorage.displayHistory();
        }
        
        function testLoadHistory() {
            const history = window.colorStorage.loadHistory();
            logResult('Load Test', `SUCCESS: Loaded ${history.length} entries`);
            console.log('History entries:', history);
        }
        
        function testDisplayHistory() {
            window.colorStorage.displayHistory();
            logResult('Display Test', 'SUCCESS: History displayed');
        }
        
        function testClearHistory() {
            if (confirm('Clear all history entries?')) {
                const result = window.colorStorage.clearHistory();
                logResult('Clear Test', result ? 'SUCCESS: History cleared' : 'FAILED: Could not clear');
            }
        }
        
        function testHistoryStats() {
            const stats = window.colorStorage.getHistoryStats();
            logResult('Stats Test', `Entries: ${stats.totalEntries}/${stats.maxEntries}, Storage: ${stats.storageUsed} bytes`);
            console.log('Full stats:', stats);
        }
        
        function logResult(test, message) {
            const resultsDiv = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.innerHTML += `[${timestamp}] ${test}: ${message}\n`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            logResult('Init', 'History test page loaded');
            
            // Test if storage module is available
            if (typeof window.colorStorage !== 'undefined') {
                logResult('Module', 'Storage module loaded successfully');
                testLoadHistory();
                testDisplayHistory();
            } else {
                logResult('Module', 'ERROR: Storage module not found');
            }
        });
    </script>
    
    <style>
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .test-btn:hover {
            background: #0056b3;
        }
    </style>
</body>
</html>