<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Interactions Test - LAB Color Calculator</title>
    <link rel="stylesheet" href="src/css/styles.css">
    <style>
        body {
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .test-section {
            margin: 40px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #2c3e50;
        }
        .test-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
        }
        .scroll-spacer {
            height: 200vh;
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Enhanced Sticky Status Bar (same as main app) -->
    <div class="status-bar" id="status-bar">
        <div class="status-bar-content">
            <div class="status-info">
                <span class="status-label">Status:</span>
                <span class="status-value" id="status-value">Ready</span>
            </div>
            <div class="delta-info">
                <span class="delta-label">ΔE*ab:</span>
                <span class="delta-value" id="status-delta-value">--</span>
            </div>
            <div class="quick-actions-bar">
                <button class="status-action-btn" id="status-calculate-btn" title="Calculate color difference">
                    Calculate
                </button>
                <button class="status-action-btn" id="status-reset-btn" title="Reset all inputs">
                    Reset
                </button>
                <button class="status-action-btn" id="status-export-btn" title="Export results" disabled>
                    Export
                </button>
            </div>
        </div>
    </div>

    <h1>Enhanced Interactions Test</h1>
    <p>This page tests the enhanced JavaScript functionality for UI enhancements.</p>

    <!-- Test Section 1: Sticky Status Bar -->
    <div class="test-section">
        <h2>1. Sticky Status Bar Test</h2>
        <p>Scroll down to test the sticky status bar functionality. The bar should appear when you scroll past the threshold.</p>
        
        <div class="test-controls">
            <button class="btn-outlined" onclick="testStatusBarVisibility()">Test Status Bar Visibility</button>
            <button class="btn-outlined" onclick="testStatusBarContent()">Test Status Bar Content</button>
            <button class="btn-outlined" onclick="simulateCalculation()">Simulate Calculation</button>
        </div>
        
        <div id="status-bar-test-result" class="test-result">
            Status bar test results will appear here...
        </div>
    </div>

    <!-- Test Section 2: Enhanced Tooltips -->
    <div class="test-section">
        <h2>2. Enhanced Tooltips Test</h2>
        <p>Hover over or focus on the elements below to test enhanced tooltip functionality.</p>
        
        <div class="test-controls">
            <h3 class="tooltip-enhanced" data-tooltip="This is a test tooltip for the Target section.&#10;It supports multiple lines and enhanced positioning.&#10;&#10;• Feature 1: Multi-line support&#10;• Feature 2: Smart positioning&#10;• Feature 3: Accessibility support" tabindex="0">
                Target Section (Hover/Focus)
            </h3>
            
            <h3 class="tooltip-enhanced" data-tooltip="This is a test tooltip for the Sample section.&#10;It demonstrates enhanced content and styling.&#10;&#10;• Measured Values: Input actual data&#10;• Color Preview: Visual representation&#10;• Quick Actions: Available options" tabindex="0">
                Sample Section (Hover/Focus)
            </h3>
            
            <h3 class="tooltip-enhanced" data-tooltip="This is a test tooltip for the Delta section.&#10;Shows calculation results and tolerance zones.&#10;&#10;• ΔE*ab < 1.0: Excellent match&#10;• ΔE*ab 1.0-2.0: Good match&#10;• ΔE*ab 2.0-4.0: Acceptable match&#10;• ΔE*ab > 4.0: Poor match" tabindex="0">
                Delta Section (Hover/Focus)
            </h3>
        </div>
        
        <div class="test-controls">
            <button class="btn-outlined" onclick="testTooltipPositioning()">Test Tooltip Positioning</button>
            <button class="btn-outlined" onclick="testTooltipContent()">Test Tooltip Content</button>
        </div>
        
        <div id="tooltip-test-result" class="test-result">
            Tooltip test results will appear here...
        </div>
    </div>

    <!-- Test Section 3: Outlined Buttons -->
    <div class="test-section">
        <h2>3. Outlined Button System Test</h2>
        <p>Test the enhanced outlined button styling and interactions.</p>
        
        <div class="test-controls">
            <button class="btn-outlined">Standard Button</button>
            <button class="btn-outlined gold">Gold Button</button>
            <button class="btn-outlined gold-premium">Gold Premium Button</button>
            <button class="btn-outlined success">Success Button</button>
            <button class="btn-outlined danger">Danger Button</button>
            <button class="btn-outlined warning">Warning Button</button>
        </div>
        
        <div class="test-controls">
            <button class="btn-outlined small">Small Button</button>
            <button class="btn-outlined">Regular Button</button>
            <button class="btn-outlined large">Large Button</button>
            <button class="btn-outlined" disabled>Disabled Button</button>
        </div>
        
        <div class="test-controls">
            <button class="btn-outlined" onclick="testButtonInteractions()">Test Button Interactions</button>
            <button class="btn-outlined loading" onclick="testButtonLoading(this)">Test Loading State</button>
        </div>
        
        <div id="button-test-result" class="test-result">
            Button test results will appear here...
        </div>
    </div>

    <!-- Test Section 4: Performance and Compatibility -->
    <div class="test-section">
        <h2>4. Performance and Compatibility Test</h2>
        <p>Test the performance and browser compatibility of enhanced interactions.</p>
        
        <div class="test-controls">
            <button class="btn-outlined" onclick="testScrollPerformance()">Test Scroll Performance</button>
            <button class="btn-outlined" onclick="testTooltipPerformance()">Test Tooltip Performance</button>
            <button class="btn-outlined" onclick="testBrowserCompatibility()">Test Browser Compatibility</button>
        </div>
        
        <div id="performance-test-result" class="test-result">
            Performance test results will appear here...
        </div>
    </div>

    <!-- Scroll spacer to test sticky behavior -->
    <div class="scroll-spacer">
        <div>
            <h3>Scroll Test Area</h3>
            <p>Scroll up and down to test the sticky status bar behavior.</p>
            <p>The status bar should appear when scrolling down and hide when at the top.</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="src/js/color-science.js"></script>
    <script src="src/js/calculator.js"></script>
    
    <script>
        // Test functions for enhanced interactions
        
        // Mock application state for testing
        if (typeof appState === 'undefined') {
            window.appState = {
                target: { cmyk: { c: 0, m: 0, y: 0, k: 0 }, lab: { l: 50, a: 0, b: 0 } },
                sample: { cmyk: { c: 0, m: 0, y: 0, k: 0 }, lab: { l: 50, a: 0, b: 0 } },
                results: null
            };
        }
        
        // Mock UI enhancement state for testing
        if (typeof uiEnhancementState === 'undefined') {
            window.uiEnhancementState = {
                statusBar: {
                    visible: false,
                    content: {
                        deltaE: null,
                        status: 'ready',
                        quickActions: ['reset', 'calculate', 'export']
                    }
                }
            };
        }

        // Test sticky status bar visibility
        function testStatusBarVisibility() {
            const result = document.getElementById('status-bar-test-result');
            const statusBar = document.getElementById('status-bar');
            
            if (!statusBar) {
                result.textContent = 'ERROR: Status bar element not found';
                return;
            }
            
            // Test visibility toggle
            statusBar.classList.add('visible');
            setTimeout(() => {
                const isVisible = statusBar.classList.contains('visible');
                result.textContent = `Status bar visibility test: ${isVisible ? 'PASS' : 'FAIL'}`;
                
                // Test hide
                setTimeout(() => {
                    statusBar.classList.remove('visible');
                    const isHidden = !statusBar.classList.contains('visible');
                    result.textContent += `\nStatus bar hide test: ${isHidden ? 'PASS' : 'FAIL'}`;
                }, 1000);
            }, 500);
        }

        // Test status bar content updates
        function testStatusBarContent() {
            const result = document.getElementById('status-bar-test-result');
            
            try {
                // Test status updates
                setCalculatingStatus();
                result.textContent = 'Testing calculating status...';
                
                setTimeout(() => {
                    setCompleteStatus();
                    result.textContent += '\nTesting complete status...';
                    
                    setTimeout(() => {
                        setReadyStatus();
                        result.textContent += '\nStatus bar content test: PASS';
                    }, 1000);
                }, 1000);
                
            } catch (error) {
                result.textContent = `Status bar content test: FAIL - ${error.message}`;
            }
        }

        // Simulate calculation for testing
        function simulateCalculation() {
            const result = document.getElementById('status-bar-test-result');
            
            try {
                // Mock calculation with status updates
                setCalculatingStatus();
                result.textContent = 'Simulating calculation...';
                
                // Mock results
                window.appState.results = {
                    deltaE: 2.45,
                    tolerance: { zone: 'acceptable' }
                };
                
                setTimeout(() => {
                    setCompleteStatus();
                    result.textContent += '\nCalculation simulation: PASS';
                }, 2000);
                
            } catch (error) {
                result.textContent = `Calculation simulation: FAIL - ${error.message}`;
            }
        }

        // Test tooltip positioning
        function testTooltipPositioning() {
            const result = document.getElementById('tooltip-test-result');
            const tooltips = document.querySelectorAll('.tooltip-enhanced');
            
            if (tooltips.length === 0) {
                result.textContent = 'ERROR: No tooltip elements found';
                return;
            }
            
            let testsPassed = 0;
            tooltips.forEach((tooltip, index) => {
                // Simulate hover
                tooltip.classList.add('tooltip-active');
                
                setTimeout(() => {
                    // Check if positioning classes are applied
                    const hasPositioning = tooltip.classList.contains('tooltip-positioned') ||
                                         tooltip.classList.contains('tooltip-left') ||
                                         tooltip.classList.contains('tooltip-right');
                    
                    if (hasPositioning) testsPassed++;
                    
                    tooltip.classList.remove('tooltip-active');
                    
                    if (index === tooltips.length - 1) {
                        result.textContent = `Tooltip positioning test: ${testsPassed}/${tooltips.length} tooltips positioned correctly`;
                    }
                }, 100 * (index + 1));
            });
        }

        // Test tooltip content
        function testTooltipContent() {
            const result = document.getElementById('tooltip-test-result');
            const tooltips = document.querySelectorAll('.tooltip-enhanced');
            
            let contentTests = 0;
            tooltips.forEach(tooltip => {
                const content = tooltip.getAttribute('data-tooltip');
                if (content && content.length > 10) {
                    contentTests++;
                }
            });
            
            result.textContent = `Tooltip content test: ${contentTests}/${tooltips.length} tooltips have valid content`;
        }

        // Test button interactions
        function testButtonInteractions() {
            const result = document.getElementById('button-test-result');
            const buttons = document.querySelectorAll('.btn-outlined:not([disabled])');
            
            let interactionTests = 0;
            buttons.forEach(button => {
                // Test hover state
                button.dispatchEvent(new MouseEvent('mouseenter'));
                
                setTimeout(() => {
                    // Check if hover styles are applied
                    const computedStyle = window.getComputedStyle(button);
                    if (computedStyle.transform !== 'none') {
                        interactionTests++;
                    }
                    
                    button.dispatchEvent(new MouseEvent('mouseleave'));
                }, 50);
            });
            
            setTimeout(() => {
                result.textContent = `Button interaction test: ${interactionTests}/${buttons.length} buttons have hover effects`;
            }, 200);
        }

        // Test button loading state
        function testButtonLoading(button) {
            const result = document.getElementById('button-test-result');
            
            button.classList.add('loading');
            button.textContent = 'Loading...';
            
            setTimeout(() => {
                button.classList.remove('loading');
                button.textContent = 'Test Loading State';
                result.textContent += '\nButton loading state test: PASS';
            }, 2000);
        }

        // Test scroll performance
        function testScrollPerformance() {
            const result = document.getElementById('performance-test-result');
            const startTime = performance.now();
            let scrollEvents = 0;
            
            const scrollHandler = () => {
                scrollEvents++;
            };
            
            window.addEventListener('scroll', scrollHandler);
            
            // Simulate scroll events
            for (let i = 0; i < 100; i++) {
                window.scrollBy(0, 1);
            }
            
            setTimeout(() => {
                window.removeEventListener('scroll', scrollHandler);
                const endTime = performance.now();
                const duration = endTime - startTime;
                
                result.textContent = `Scroll performance test: ${duration.toFixed(2)}ms for ${scrollEvents} events`;
                
                // Reset scroll position
                window.scrollTo(0, 0);
            }, 100);
        }

        // Test tooltip performance
        function testTooltipPerformance() {
            const result = document.getElementById('performance-test-result');
            const tooltips = document.querySelectorAll('.tooltip-enhanced');
            const startTime = performance.now();
            
            // Simulate rapid tooltip interactions
            tooltips.forEach((tooltip, index) => {
                setTimeout(() => {
                    tooltip.dispatchEvent(new MouseEvent('mouseenter'));
                    
                    setTimeout(() => {
                        tooltip.dispatchEvent(new MouseEvent('mouseleave'));
                        
                        if (index === tooltips.length - 1) {
                            const endTime = performance.now();
                            const duration = endTime - startTime;
                            result.textContent += `\nTooltip performance test: ${duration.toFixed(2)}ms for ${tooltips.length} tooltips`;
                        }
                    }, 50);
                }, index * 100);
            });
        }

        // Test browser compatibility
        function testBrowserCompatibility() {
            const result = document.getElementById('performance-test-result');
            const features = {
                'CSS Custom Properties': CSS.supports('color', 'var(--test)'),
                'CSS Grid': CSS.supports('display', 'grid'),
                'CSS Flexbox': CSS.supports('display', 'flex'),
                'CSS Transforms': CSS.supports('transform', 'translateX(0)'),
                'CSS Transitions': CSS.supports('transition', 'all 0.3s ease'),
                'Backdrop Filter': CSS.supports('backdrop-filter', 'blur(10px)'),
                'Intersection Observer': 'IntersectionObserver' in window,
                'Performance API': 'performance' in window
            };
            
            const supported = Object.entries(features).filter(([name, supported]) => supported);
            const total = Object.keys(features).length;
            
            result.textContent += `\nBrowser compatibility: ${supported.length}/${total} features supported`;
            
            // List unsupported features
            const unsupported = Object.entries(features).filter(([name, supported]) => !supported);
            if (unsupported.length > 0) {
                result.textContent += `\nUnsupported: ${unsupported.map(([name]) => name).join(', ')}`;
            }
        }

        // Initialize test page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Enhanced interactions test page loaded');
            
            // Initialize tooltip manager if available
            if (typeof TooltipManager !== 'undefined') {
                window.testTooltipManager = new TooltipManager();
                console.log('Tooltip manager initialized for testing');
            }
            
            // Initialize sticky status bar functionality
            if (typeof initializeStickyStatusBar === 'function') {
                initializeStickyStatusBar();
                console.log('Sticky status bar initialized for testing');
            }
            
            // Run initial tests
            setTimeout(() => {
                console.log('Running initial compatibility tests...');
                testBrowserCompatibility();
            }, 1000);
        });
    </script>
</body>
</html>