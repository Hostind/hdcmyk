<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HD CMYK • Pro LAB/CMYK Match Studio — Ultra Stable</title>
    <meta name="description" content="Professional HD CMYK color matching with LAB analysis, ICC profiles, heatmap visualization, and industry workflows">
    <meta name="theme-color" content="#1f2937">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HD CMYK Studio">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="src/assets/icons/icon.svg">
    <link rel="apple-touch-icon" href="src/assets/icons/icon.svg">
    <link rel="stylesheet" href="src/css/styles.css">
    <link rel="stylesheet" href="src/css/grid-styles.css">
    <link rel="stylesheet" href="src/css/spectrophotometer-styles.css">
    <link rel="stylesheet" href="src/css/measurement-history-styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1f2937;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Enhanced Status Bar */
        .status-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 1001;
            transform: translateY(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .status-bar.visible {
            transform: translateY(0);
        }

        .status-bar-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            height: 100%;
            gap: 20px;
        }

        .status-info,
        .delta-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-label,
        .delta-label {
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.75rem;
        }

        .status-value,
        .delta-value {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 0.75rem;
            min-width: 60px;
            text-align: center;
        }

        .quick-actions-bar {
            display: flex;
            gap: 8px;
        }

        .status-action-btn {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            color: #6b7280;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-action-btn:hover:not(:disabled) {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            color: #667eea;
        }

        .status-action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Sticky Header Styles */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            margin-bottom: 40px;
            padding: 15px 0;
        }

        /* Adjust container top margin when status bar is visible */
        .container {
            margin-top: 0;
            transition: margin-top 0.3s ease;
        }

        .status-bar.visible ~ .container {
            margin-top: 50px;
        }

        .header {
            color: white;
        }

        .sticky-header .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .sticky-header .header-text {
            flex: 1;
            text-align: left;
        }

        .sticky-header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sticky-header .subtitle {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
            margin: 0;
            opacity: 0.8;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .header-btn {
            padding: 8px 16px;
            background: rgba(103, 126, 234, 0.1);
            border: 1px solid rgba(103, 126, 234, 0.2);
            border-radius: 20px;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .header-btn:hover {
            background: rgba(103, 126, 234, 0.2);
            border-color: rgba(103, 126, 234, 0.4);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(103, 126, 234, 0.2);
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .theme-icon {
            font-size: 18px;
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(20deg);
        }

        /* Three-Column HD CMYK Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .color-panel {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            padding: 30px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .color-panel:hover {
            border-color: #667eea;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f3f4f6;
        }

        .panel-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-status {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 12px;
            background: #f3f4f6;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .panel-status.ready {
            background: #dcfce7;
            color: #166534;
        }

        .panel-status.calculating {
            background: #fef3c7;
            color: #92400e;
        }

        .panel-status.complete {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Analysis Panel Specific Styles */
        .analysis-panel {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
        }

        .quick-analysis {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .delta-preview {
            margin-bottom: 20px;
        }

        .delta-preview-value {
            font-size: 3rem;
            font-weight: 800;
            color: #667eea;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 5px;
        }

        .delta-preview-label {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tolerance-preview {
            margin-bottom: 20px;
        }

        .tolerance-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: #f3f4f6;
            color: #6b7280;
        }

        .tolerance-badge.excellent {
            background: #10b981;
            color: white;
        }

        .tolerance-badge.good {
            background: #f59e0b;
            color: white;
        }

        .tolerance-badge.acceptable {
            background: #ef4444;
            color: white;
        }

        .tolerance-badge.poor {
            background: #7c2d12;
            color: white;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1f2937;
            font-family: 'JetBrains Mono', monospace;
        }

        .color-swatch {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            border: 3px solid #e5e7eb;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            background: #f3f4f6;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #374151;
        }

        .input-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
        }

        .input-field {
            display: flex;
            flex-direction: column;
        }

        .input-field label {
            font-size: 12px;
            margin-bottom: 5px;
            color: #6b7280;
        }

        .input-field input {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .input-field input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .calculate-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .calculate-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            width: 100%;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .calculate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .reset-btn,
        #reset-all-btn {
            padding: 12px 30px;
            background: transparent;
            color: #6b7280;
            border: 2px solid #e5e7eb;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .reset-btn:hover,
        #reset-all-btn:hover {
            border-color: #667eea;
            color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        /* Enhanced Results Section */
        .results-section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f3f4f6;
        }

        .results-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .tolerance-zone {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tolerance-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tolerance-indicator.excellent {
            background: #10b981;
            color: white;
        }

        .tolerance-indicator.good {
            background: #f59e0b;
            color: white;
        }

        .tolerance-indicator.acceptable {
            background: #ef4444;
            color: white;
        }

        .tolerance-indicator.poor {
            background: #7c2d12;
            color: white;
        }

        /* Primary ΔE Display */
        .primary-delta-display {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 40px;
            margin-bottom: 40px;
            align-items: center;
        }

        .delta-e-main {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            color: white;
        }

        .delta-e-value {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 10px;
            font-family: 'JetBrains Mono', monospace;
        }

        .delta-e-label {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 500;
        }

        /* ΔE Suite */
        .delta-e-suite {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .delta-method {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .delta-method:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .method-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .method-label {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Component Analysis */
        .component-analysis {
            margin-bottom: 30px;
        }

        .component-analysis h4 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        .component-deltas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .delta-component {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .delta-component:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }

        .delta-component-label {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .delta-component-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 10px;
            font-family: 'JetBrains Mono', monospace;
        }

        .component-bar {
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .component-bar::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        /* Correction Suggestions */
        .correction-suggestions {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 15px;
            padding: 25px;
        }

        .correction-suggestions h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #0c4a6e;
            margin-bottom: 15px;
        }

        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .suggestion-item {
            background: white;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .suggestion-label {
            font-size: 0.75rem;
            color: #0369a1;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .suggestion-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #0c4a6e;
            font-family: 'JetBrains Mono', monospace;
        }

        .advanced-features {
            display: none;
            animation: slideDown 0.5s ease;
        }

        .advanced-features.show {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #3b82f6;
        }

        .feature-card h3 {
            margin-bottom: 20px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }

        .control-group select,
        .control-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .heatmap-container {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .heatmap-canvas {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        /* Client Profile Modal Styles */
        .profile-management-section {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .profile-tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            color: #374151;
            background: rgba(102, 126, 234, 0.05);
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .substrate-checkboxes {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 8px;
        }

        .substrate-checkboxes label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
            margin-bottom: 0;
        }

        .workflow-settings {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }

        .workflow-settings label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
            margin-bottom: 0;
        }

        .sop-management {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
        }

        .sop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .sop-header h4 {
            margin: 0;
            color: #374151;
        }

        .sop-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            width: 150px;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            width: 0%;
            transition: width 0.3s ease;
        }

        .sop-checklist {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .sop-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .sop-item:last-child {
            border-bottom: none;
        }

        .sop-checkbox {
            margin-top: 2px;
        }

        .sop-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .sop-text.completed {
            text-decoration: line-through;
            color: #6b7280;
        }

        .sop-item-actions {
            display: flex;
            gap: 5px;
        }

        .sop-item-btn {
            padding: 4px 8px;
            background: none;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #6b7280;
        }

        .sop-item-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .sop-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-start;
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .current-profile-status {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #bae6fd;
        }

        .active-profile-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .profile-info-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #e0f2fe;
        }

        .profile-info-label {
            font-size: 12px;
            color: #0369a1;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .profile-info-value {
            font-size: 14px;
            color: #0c4a6e;
            font-weight: 500;
        }

        /* Notification animations */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Responsive adjustments for profile modal */
        @media (max-width: 768px) {
            .profile-tabs {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                flex: 1;
                min-width: 120px;
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .substrate-checkboxes {
                grid-template-columns: 1fr;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
            
            .sop-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .profile-actions {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        .status-bar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .extended-gamut {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .extended-gamut h4 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ogv-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .ogv-inputs .input-field input {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .ogv-inputs .input-field input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .tolerance-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 15px;
        }

        .tolerance-excellent {
            background: #10b981;
            color: white;
        }

        .tolerance-good {
            background: #f59e0b;
            color: white;
        }

        .tolerance-poor {
            background: #ef4444;
            color: white;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr 1fr;
                gap: 25px;
            }
            
            .analysis-panel {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .sticky-header .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .sticky-header .header-text {
                text-align: center;
            }

            .sticky-header h1 {
                font-size: 1.5rem;
            }

            .sticky-header .subtitle {
                font-size: 0.75rem;
            }

            .header-controls {
                justify-content: center;
                gap: 8px;
            }

            .header-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .main-card {
                padding: 25px;
            }

            .primary-delta-display {
                grid-template-columns: 1fr;
                gap: 25px;
            }

            .delta-e-suite {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .delta-e-value {
                font-size: 3rem;
            }

            .method-value {
                font-size: 1.5rem;
            }

            .component-deltas {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .control-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .status-bar-content {
                flex-direction: column;
                height: auto;
                padding: 8px 15px;
                gap: 8px;
            }

            .status-bar {
                height: auto;
                min-height: 50px;
            }

            .status-bar.visible ~ .container {
                margin-top: 60px;
            }

            .quick-actions-bar {
                justify-content: center;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            .sticky-header {
                padding: 10px 0;
            }

            .sticky-header h1 {
                font-size: 1.25rem;
            }

            .main-layout {
                padding: 20px;
            }

            .delta-e-value {
                font-size: 2.5rem;
            }

            .results-section {
                padding: 25px;
            }

            .status-bar-content {
                padding: 6px 10px;
            }

            .status-action-btn {
                padding: 4px 8px;
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sticky Header with HD Features -->
        <header class="header sticky-header" id="main-header">
            <div class="header-content">
                <div class="header-text">
                    <h1>HD CMYK • Pro LAB/CMYK Match Studio</h1>
                    <p class="subtitle">Ultra Stable • ΔE suite • Patch heatmap • CCM • Substrate simulation • ICC soft proof • CMYKOGV</p>
                </div>
                <div class="header-controls">
                    <button class="header-btn theme-toggle" id="theme-toggle" title="Toggle dark/light mode">
                        <span class="theme-icon">🌙</span>
                    </button>
                    <button class="header-btn" id="client-profile-btn" title="Manage client profiles and SOPs">
                        👤 Profiles
                    </button>
                    <button class="header-btn" id="icc-profile-btn" title="Load ICC profiles for accurate color">
                        🎨 ICC
                    </button>
                    <button class="header-btn" id="advanced-toggle" title="Toggle HD features visibility">
                        🔬 HD Features
                    </button>
                </div>
            </div>
        </header>

        <!-- Three-Column HD CMYK Layout -->
        <div class="main-layout">
            <!-- Column 1: Target Color -->
            <div class="color-panel target-panel">
                <div class="panel-header">
                    <h2>🎯 Target Color</h2>
                    <div class="panel-status" id="target-status">Ready</div>
                </div>
                <div class="color-swatch" id="target-swatch"></div>
                    
                    <div class="input-group">
                        <label>CMYK Values (%)</label>
                        <div class="input-row">
                            <div class="input-field">
                                <label>C%</label>
                                <input type="number" id="target-c" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label>M%</label>
                                <input type="number" id="target-m" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label>Y%</label>
                                <input type="number" id="target-y" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label>K%</label>
                                <input type="number" id="target-k" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>LAB Values</label>
                        <div class="input-row">
                            <div class="input-field">
                                <label>L*</label>
                                <input type="number" id="target-l" placeholder="50" min="0" max="100" step="0.01">
                            </div>
                            <div class="input-field">
                                <label>a*</label>
                                <input type="number" id="target-a" placeholder="0" min="-128" max="127" step="0.01">
                            </div>
                            <div class="input-field">
                                <label>b*</label>
                                <input type="number" id="target-b" placeholder="0" min="-128" max="127" step="0.01">
                            </div>
                        </div>
                    </div>

                    <!-- Extended Gamut for Target -->
                    <div class="extended-gamut" id="target-extended-gamut" style="display: none;">
                        <h4>🌈 Extended Gamut (OGV)</h4>
                        <div class="ogv-inputs">
                            <div class="input-field">
                                <label>O%</label>
                                <input type="number" id="target-o" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label>G%</label>
                                <input type="number" id="target-g" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label>V%</label>
                                <input type="number" id="target-v" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                        </div>
                    </div>
                </div>

            <!-- Column 2: Press/Sample Color -->
            <div class="color-panel press-panel">
                <div class="panel-header">
                    <h2>🔍 Press Color</h2>
                    <div class="panel-status" id="press-status">Ready</div>
                </div>
                <div class="color-swatch" id="sample-swatch"></div>
                    
                    <div class="input-group">
                        <label>CMYK Values (%)</label>
                        <div class="input-row">
                            <div class="input-field">
                                <label>C%</label>
                                <input type="number" id="sample-c" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label>M%</label>
                                <input type="number" id="sample-m" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label>Y%</label>
                                <input type="number" id="sample-y" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label>K%</label>
                                <input type="number" id="sample-k" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>LAB Values</label>
                        <div class="input-row">
                            <div class="input-field">
                                <label>L*</label>
                                <input type="number" id="sample-l" placeholder="50" min="0" max="100" step="0.01">
                            </div>
                            <div class="input-field">
                                <label>a*</label>
                                <input type="number" id="sample-a" placeholder="0" min="-128" max="127" step="0.01">
                            </div>
                            <div class="input-field">
                                <label>b*</label>
                                <input type="number" id="sample-b" placeholder="0" min="-128" max="127" step="0.01">
                            </div>
                        </div>
                    </div>

                    <!-- Extended Gamut for Sample -->
                    <div class="extended-gamut" id="sample-extended-gamut" style="display: none;">
                        <h4>🌈 Extended Gamut (OGV)</h4>
                        <div class="ogv-inputs">
                            <div class="input-field">
                                <label>O%</label>
                                <input type="number" id="sample-o" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label>G%</label>
                                <input type="number" id="sample-g" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-field">
                                <label>V%</label>
                                <input type="number" id="sample-v" placeholder="0" min="0" max="100" step="0.1">
                            </div>
                        </div>
                    </div>
                </div>
            
            <!-- Column 3: Analysis & Results -->
            <div class="analysis-panel">
                <div class="panel-header">
                    <h2>📊 Analysis</h2>
                    <div class="panel-status" id="analysis-status">Waiting</div>
                </div>
                
                <div class="quick-analysis" id="quick-analysis">
                    <div class="delta-preview">
                        <div class="delta-preview-value" id="delta-preview">--</div>
                        <div class="delta-preview-label">ΔE*ab</div>
                    </div>
                    
                    <div class="tolerance-preview" id="tolerance-preview">
                        <span class="tolerance-badge" id="tolerance-badge">Calculate</span>
                    </div>
                </div>
                
                <div class="calculate-section">
                    <button class="calculate-btn" id="calculate-btn">⚡ Calculate Color Difference</button>
                    <button class="reset-btn" id="reset-all-btn">🔄 Reset All</button>
                </div>
                
                <!-- Quick Stats -->
                <div class="quick-stats" id="quick-stats" style="display: none;">
                    <div class="stat-item">
                        <div class="stat-label">TAC</div>
                        <div class="stat-value" id="tac-display">0%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Substrate</div>
                        <div class="stat-value" id="substrate-display">HPW</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Results Section with ΔE Suite -->
        <div class="results-section" id="results-section" style="display: none;">
            <div class="results-header">
                <h3>Color Difference Analysis</h3>
                <div class="tolerance-zone" id="tolerance-zone">
                    <span class="tolerance-indicator" id="tolerance-indicator">Calculating...</span>
                </div>
            </div>
            
            <!-- Primary ΔE Display -->
            <div class="primary-delta-display">
                <div class="delta-e-main">
                    <div class="delta-e-value" id="delta-e-value">--</div>
                    <div class="delta-e-label">ΔE*ab (CIE76)</div>
                </div>
                
                <!-- ΔE Suite - Multiple Methods -->
                <div class="delta-e-suite">
                    <div class="delta-method">
                        <div class="method-value" id="delta-e-94">--</div>
                        <div class="method-label">ΔE*94</div>
                    </div>
                    <div class="delta-method">
                        <div class="method-value" id="delta-e-2000">--</div>
                        <div class="method-label">ΔE*00</div>
                    </div>
                    <div class="delta-method">
                        <div class="method-value" id="delta-cmc">--</div>
                        <div class="method-label">ΔE CMC</div>
                    </div>
                </div>
            </div>
            
            <!-- Component Analysis -->
            <div class="component-analysis">
                <h4>Component Analysis</h4>
                <div class="component-deltas">
                    <div class="delta-component">
                        <div class="delta-component-label">ΔL* (Lightness)</div>
                        <div class="delta-component-value" id="delta-l">--</div>
                        <div class="component-bar" id="delta-l-bar"></div>
                    </div>
                    <div class="delta-component">
                        <div class="delta-component-label">Δa* (Green-Red)</div>
                        <div class="delta-component-value" id="delta-a">--</div>
                        <div class="component-bar" id="delta-a-bar"></div>
                    </div>
                    <div class="delta-component">
                        <div class="delta-component-label">Δb* (Blue-Yellow)</div>
                        <div class="delta-component-value" id="delta-b">--</div>
                        <div class="component-bar" id="delta-b-bar"></div>
                    </div>
                    <div class="delta-component">
                        <div class="delta-component-label">ΔC* (Chroma)</div>
                        <div class="delta-component-value" id="delta-c">--</div>
                        <div class="component-bar" id="delta-c-bar"></div>
                    </div>
                    <div class="delta-component">
                        <div class="delta-component-label">Δh (Hue Angle)</div>
                        <div class="delta-component-value" id="delta-h">--</div>
                        <div class="component-bar" id="delta-h-bar"></div>
                    </div>
                </div>
            </div>

            <!-- Correction Suggestions -->
            <div class="correction-suggestions" id="correction-suggestions" style="display: none;">
                <h4>🎯 Correction Suggestions</h4>
                <div class="suggestions-grid" id="suggestions-grid">
                    <!-- Dynamic correction suggestions will be populated here -->
                </div>
            </div>
        </div>

        <!-- Advanced HD Features -->
        <div class="advanced-features" id="advanced-features">
            <!-- Substrate & Settings -->
            <div class="feature-card">
                <h3>⚙️ HD Analysis Settings</h3>
                <div class="control-grid">
                    <div class="control-group">
                        <label>Substrate Type</label>
                        <select id="substrate-select">
                            <option value="hpw">Hot Press White</option>
                            <option value="inver">Invercote</option>
                            <option value="gsm250">250 gsm</option>
                            <option value="foil">Foil Board</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Illuminant / Observer</label>
                        <select id="illuminant-select">
                            <option value="D50/2°">D50 / 2°</option>
                            <option value="D50/10°">D50 / 10°</option>
                            <option value="D65/2°">D65 / 2°</option>
                            <option value="D65/10°">D65 / 10°</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>ΔE Tolerance</label>
                        <input id="tolerance-input" type="number" step="0.1" value="2.0" min="0.1" max="10">
                    </div>
                </div>
                <div style="margin-top: 15px;">
                    <span style="font-weight: 600;">Total Area Coverage (TAC): </span>
                    <span id="tac-value" style="font-weight: 600; color: #3b82f6;">0%</span>
                </div>
            </div>

            <!-- Patch Grid System -->
            <div class="feature-card">
                <h3>🔥 Batch Color Analysis Grid</h3>
                <div id="grid-system-container">
                    <!-- Grid system will be initialized here -->
                </div>
            </div>

            <!-- Color Correction Matrix -->
            <div class="feature-card">
                <h3>🧮 Color Correction Matrix (CCM)</h3>
                <div class="control-grid">
                    <div class="control-group">
                        <label>Target CSV (L*,a*,b*)</label>
                        <input type="file" id="ccm-target-csv" accept=".csv">
                    </div>
                    <div class="control-group">
                        <label>Press CSV (L*,a*,b*)</label>
                        <input type="file" id="ccm-press-csv" accept=".csv">
                    </div>
                </div>
                <div style="margin: 20px 0;">
                    <button class="btn btn-primary" id="compute-ccm">📊 Compute CCM</button>
                    <button class="btn btn-secondary" id="apply-ccm">→ Apply CCM</button>
                </div>
                <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-top: 15px;">
                    <pre id="ccm-matrix-output" style="font-family: 'Courier New', monospace; margin: 0;">CCM Matrix: (not computed)</pre>
                </div>
            </div>

            <!-- Brand Color Library -->
            <div class="feature-card">
                <div id="color-library-container">
                    <!-- Color library will be initialized here -->
                </div>
            </div>
            <!-- Measurement History & Statistical Analysis -->
            <div class="feature-card">
                <h3>📊 Measurement History & Statistical Analysis</h3>
                <div class="control-grid">
                    <div class="control-group">
                        <label>Operator Name</label>
                        <input type="text" id="operator-input" placeholder="Enter operator name" value="System">
                    </div>
                    <div class="control-group">
                        <label>Job ID</label>
                        <input type="text" id="job-id-input" placeholder="Enter job ID (optional)">
                    </div>
                    <div class="control-group">
                        <label>Notes</label>
                        <input type="text" id="calculation-notes" placeholder="Add notes (optional)">
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <button class="btn btn-primary" id="show-history-btn">📈 View History & Statistics</button>
                    <button class="btn btn-secondary" id="export-history-btn">📤 Export History</button>
                    <button class="btn btn-secondary" id="show-trend-chart-btn">📊 Trend Chart</button>
                </div>

                <!-- Quick Statistics Display -->
                <div id="quick-stats-display" style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-top: 15px; display: none;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; text-align: center;">
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #1f2937;" id="stat-median">--</div>
                            <div style="font-size: 0.75rem; color: #6b7280; font-weight: 600;">MEDIAN ΔE</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #1f2937;" id="stat-p95">--</div>
                            <div style="font-size: 0.75rem; color: #6b7280; font-weight: 600;">95TH %ILE</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #1f2937;" id="stat-max">--</div>
                            <div style="font-size: 0.75rem; color: #6b7280; font-weight: 600;">MAXIMUM</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #1f2937;" id="stat-count">--</div>
                            <div style="font-size: 0.75rem; color: #6b7280; font-weight: 600;">SAMPLES</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; text-align: center;">
                        <span style="font-size: 0.875rem; color: #6b7280;">Process Stability: </span>
                        <span id="stability-indicator" style="font-size: 0.875rem; font-weight: 600;">--</span>
                    </div>
                </div>
            </div>

            <!-- Pocket Color Converter -->
            <div class="feature-card">
                <h3>🎨 Pocket Color Converter</h3>
                <div class="color-converter">
                    <div class="converter-grid">
                        <!-- HEX Section -->
                        <div class="converter-section">
                            <div class="converter-header">
                                <label for="converter-hex">HEX</label>
                                <button class="converter-copy-btn" data-format="hex" title="Copy HEX value">📋</button>
                            </div>
                            <input type="text" id="converter-hex" class="converter-input" placeholder="#FF5733" maxlength="7">
                            <div class="converter-error" id="converter-hex-error"></div>
                            <div class="converter-warning" id="converter-hex-warning"></div>
                        </div>

                        <!-- RGB Section -->
                        <div class="converter-section">
                            <div class="converter-header">
                                <label>RGB</label>
                                <button class="converter-copy-btn" data-format="rgb" title="Copy RGB value">📋</button>
                            </div>
                            <div class="rgb-inputs">
                                <input type="number" id="converter-rgb-r" class="converter-input rgb-input" placeholder="R" min="0" max="255">
                                <input type="number" id="converter-rgb-g" class="converter-input rgb-input" placeholder="G" min="0" max="255">
                                <input type="number" id="converter-rgb-b" class="converter-input rgb-input" placeholder="B" min="0" max="255">
                            </div>
                            <div class="converter-error" id="converter-rgb-error"></div>
                            <div class="converter-warning" id="converter-rgb-warning"></div>
                        </div>

                        <!-- CMYK Section -->
                        <div class="converter-section">
                            <div class="converter-header">
                                <label>CMYK</label>
                                <button class="converter-copy-btn" data-format="cmyk" title="Copy CMYK value">📋</button>
                            </div>
                            <div class="cmyk-inputs">
                                <input type="number" id="converter-cmyk-c" class="converter-input cmyk-input" placeholder="C" min="0" max="100" step="0.1">
                                <input type="number" id="converter-cmyk-m" class="converter-input cmyk-input" placeholder="M" min="0" max="100" step="0.1">
                                <input type="number" id="converter-cmyk-y" class="converter-input cmyk-input" placeholder="Y" min="0" max="100" step="0.1">
                                <input type="number" id="converter-cmyk-k" class="converter-input cmyk-input" placeholder="K" min="0" max="100" step="0.1">
                            </div>
                            <div class="converter-error" id="converter-cmyk-error"></div>
                            <div class="converter-warning" id="converter-cmyk-warning"></div>
                        </div>

                        <!-- LAB Section -->
                        <div class="converter-section">
                            <div class="converter-header">
                                <label>LAB</label>
                                <button class="converter-copy-btn" data-format="lab" title="Copy LAB value">📋</button>
                            </div>
                            <div class="lab-inputs">
                                <input type="number" id="converter-lab-l" class="converter-input lab-input" placeholder="L*" min="0" max="100" step="0.1">
                                <input type="number" id="converter-lab-a" class="converter-input lab-input" placeholder="a*" min="-128" max="127" step="0.1">
                                <input type="number" id="converter-lab-b" class="converter-input lab-input" placeholder="b*" min="-128" max="127" step="0.1">
                            </div>
                            <div class="converter-error" id="converter-lab-error"></div>
                            <div class="converter-warning" id="converter-lab-warning"></div>
                        </div>
                    </div>

                    <!-- Color Preview and Actions -->
                    <div class="converter-preview-section">
                        <div class="color-preview-container">
                            <div class="color-preview" id="converter-color-preview" aria-label="Color preview"></div>
                            <div class="preview-label">Color Preview</div>
                        </div>
                        <div class="converter-actions">
                            <button class="btn btn-secondary" id="converter-clear-btn">🗑️ Clear</button>
                            <button class="btn btn-primary" id="converter-swap-btn">↗️ Send to Calculator</button>
                        </div>
                    </div>

                    <!-- General Error Display -->
                    <div class="converter-error" id="converter-general-error" style="margin-top: 15px;"></div>

                    <!-- Accuracy Information -->
                    <div class="converter-info">
                        <div class="info-item">
                            <span class="info-icon">ℹ️</span>
                            <span class="info-text">Color conversions are approximate. Use ICC profiles for print accuracy.</span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">⌨️</span>
                            <span class="info-text">Paste color values directly into any field for quick conversion.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Measurement History Modal -->
    <div class="modal" id="measurement-history-modal">
        <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>📊 Measurement History & Statistical Analysis</h2>
                <button class="modal-close" id="history-modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="measurement-history-container">
                    <!-- Measurement history table will be created here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Trend Chart Modal -->
    <div class="modal" id="trend-chart-modal">
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>📈 Measurement Trend Analysis</h2>
                <button class="modal-close" id="trend-modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="trend-chart-container" style="text-align: center; padding: 20px;">
                    <!-- Trend visualization will be created here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Client Profile Modal -->
    <div class="modal" id="client-profile-modal">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>👤 Client Profile & SOP Management</h2>
                <button class="modal-close" id="client-modal-close">×</button>
            </div>
            <div class="modal-body">
                <!-- Profile Selection and Management -->
                <div class="profile-management-section">
                    <div class="control-grid">
                        <div class="control-group">
                            <label>Select Profile</label>
                            <select id="client-profile-select">
                                <option value="">Select a profile...</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <button class="btn btn-primary" id="new-profile-btn">➕ New Profile</button>
                        </div>
                        <div class="control-group">
                            <button class="btn btn-secondary" id="import-profile-btn">📥 Import</button>
                        </div>
                        <div class="control-group">
                            <button class="btn btn-secondary" id="export-profile-btn" disabled>📤 Export</button>
                        </div>
                    </div>
                </div>

                <!-- Profile Editor -->
                <div id="profile-editor" style="display: none; margin-top: 30px;">
                    <div class="profile-tabs">
                        <button class="tab-btn active" data-tab="basic">Basic Settings</button>
                        <button class="tab-btn" data-tab="preferences">Preferences</button>
                        <button class="tab-btn" data-tab="sop">SOP Checklist</button>
                        <button class="tab-btn" data-tab="contact">Contact Info</button>
                    </div>

                    <!-- Basic Settings Tab -->
                    <div class="tab-content active" id="basic-tab">
                        <div class="control-grid">
                            <div class="control-group">
                                <label>Profile Name *</label>
                                <input type="text" id="profile-name" placeholder="Client Name" required>
                            </div>
                            <div class="control-group">
                                <label>ΔE Tolerance</label>
                                <input type="number" id="profile-tolerance" step="0.1" value="2.0" min="0.1" max="10.0">
                            </div>
                            <div class="control-group">
                                <label>Delta E Method</label>
                                <select id="profile-delta-method">
                                    <option value="de2000">CIEDE2000 (Recommended)</option>
                                    <option value="de94">CIE94</option>
                                    <option value="de76">CIE76</option>
                                </select>
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Client Notes</label>
                            <textarea id="profile-notes" rows="3" placeholder="Client-specific notes, requirements, special instructions..." style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; resize: vertical;"></textarea>
                        </div>
                    </div>

                    <!-- Preferences Tab -->
                    <div class="tab-content" id="preferences-tab">
                        <div class="control-grid">
                            <div class="control-group">
                                <label>Preferred Substrate</label>
                                <select id="profile-substrate">
                                    <option value="hpw">Hot Press White</option>
                                    <option value="inver">Invercote</option>
                                    <option value="gsm250">250gsm</option>
                                    <option value="foil">Foil Board</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Illuminant</label>
                                <select id="profile-illuminant">
                                    <option value="D50/2°">D50/2° (Standard)</option>
                                    <option value="D65/10°">D65/10°</option>
                                    <option value="A/2°">A/2°</option>
                                    <option value="F2/2°">F2/2°</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Auto-Apply Settings</label>
                                <input type="checkbox" id="profile-auto-apply" checked>
                                <small>Automatically apply profile settings when selected</small>
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Approved Substrates</label>
                            <div class="substrate-checkboxes">
                                <label><input type="checkbox" id="substrate-hpw" value="hpw"> Hot Press White</label>
                                <label><input type="checkbox" id="substrate-inver" value="inver"> Invercote</label>
                                <label><input type="checkbox" id="substrate-gsm250" value="gsm250"> 250gsm</label>
                                <label><input type="checkbox" id="substrate-foil" value="foil"> Foil Board</label>
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Workflow Settings</label>
                            <div class="workflow-settings">
                                <label><input type="checkbox" id="require-approval"> Require approval for color adjustments</label>
                                <label><input type="checkbox" id="auto-generate-reports"> Auto-generate measurement reports</label>
                                <label><input type="checkbox" id="enable-notifications"> Enable email notifications</label>
                            </div>
                        </div>
                    </div>

                    <!-- SOP Checklist Tab -->
                    <div class="tab-content" id="sop-tab">
                        <div class="sop-management">
                            <div class="control-group">
                                <label>SOP for Substrate</label>
                                <select id="sop-substrate-select">
                                    <option value="hpw">Hot Press White</option>
                                    <option value="inver">Invercote</option>
                                    <option value="gsm250">250gsm</option>
                                    <option value="foil">Foil Board</option>
                                </select>
                                <button class="btn btn-secondary" id="load-default-sop">Load Default</button>
                            </div>
                            
                            <div class="sop-checklist-container">
                                <div class="sop-header">
                                    <h4>Standard Operating Procedure Checklist</h4>
                                    <div class="sop-progress">
                                        <span id="sop-progress-text">0 of 0 completed</span>
                                        <div class="progress-bar">
                                            <div class="progress-fill" id="sop-progress-fill"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="sop-checklist" id="sop-checklist">
                                    <!-- SOP items will be populated here -->
                                </div>
                                
                                <div class="sop-actions">
                                    <button class="btn btn-secondary" id="add-sop-item">➕ Add Item</button>
                                    <button class="btn btn-secondary" id="reset-sop-checklist">🔄 Reset Checklist</button>
                                    <button class="btn btn-primary" id="save-sop">💾 Save SOP</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Info Tab -->
                    <div class="tab-content" id="contact-tab">
                        <div class="control-grid">
                            <div class="control-group">
                                <label>Contact Name</label>
                                <input type="text" id="contact-name" placeholder="Primary contact name">
                            </div>
                            <div class="control-group">
                                <label>Email Address</label>
                                <input type="email" id="contact-email" placeholder="client@example.com">
                            </div>
                            <div class="control-group">
                                <label>Phone Number</label>
                                <input type="tel" id="contact-phone" placeholder="+1 (555) 123-4567">
                            </div>
                            <div class="control-group">
                                <label>Company</label>
                                <input type="text" id="contact-company" placeholder="Company name">
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Address</label>
                            <textarea id="contact-address" rows="3" placeholder="Company address..." style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; resize: vertical;"></textarea>
                        </div>
                        <div class="control-group">
                            <label>Additional Notes</label>
                            <textarea id="contact-notes" rows="2" placeholder="Special requirements, preferred communication methods, etc..." style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; resize: vertical;"></textarea>
                        </div>
                    </div>

                    <!-- Profile Actions -->
                    <div class="profile-actions" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                        <button class="btn btn-primary" id="save-profile">💾 Save Profile</button>
                        <button class="btn btn-secondary" id="cancel-profile-edit">✖ Cancel</button>
                        <button class="btn" id="delete-profile" style="background: #ef4444; color: white; margin-left: auto;">🗑️ Delete</button>
                    </div>
                </div>

                <!-- Current Profile Status -->
                <div id="current-profile-status" style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; display: none;">
                    <h4>Current Active Profile</h4>
                    <div id="active-profile-info">
                        <!-- Active profile information will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for profile import -->
    <input type="file" id="profile-import-input" accept=".json" style="display: none;">

    <!-- Enhanced Status Bar -->
    <div class="status-bar" id="status-bar">
        <div class="status-bar-content">
            <div class="status-info">
                <span class="status-label">Status</span>
                <span class="status-value" id="status-value">Ready</span>
            </div>
            <div class="delta-info">
                <span class="delta-label">ΔE</span>
                <span class="delta-value" id="status-delta-value">--</span>
            </div>
            <div class="quick-actions-bar">
                <button class="status-action-btn" id="status-calculate-btn">Calculate</button>
                <button class="status-action-btn" id="status-reset-btn">Reset</button>
                <button class="status-action-btn" id="status-export-btn" disabled>Export</button>
            </div>
        </div>
    </div>

    <!-- Core Scripts -->
    <script src="src/js/color-science.js"></script>
    <script src="src/js/pantone-colors.js"></script>
    <script src="src/js/storage.js"></script>
    <script src="src/js/export.js"></script>
    
    <!-- HD Color Engine Scripts -->
    <script src="src/js/hd-color-engine.js"></script>
    <script src="src/js/csv-enhanced.js"></script>
    <script src="src/js/heatmap-visualization.js"></script>
    <script src="src/js/grid-manager.js"></script>
    <script src="src/js/spectrophotometer-integration.js"></script>
    <script src="src/js/client-profiles.js"></script>
    <script src="src/js/client-profile-ui.js"></script>
    <script src="src/js/icc-profile-manager.js"></script>
    <script src="src/js/substrate-profiles.js"></script>
    <script src="src/js/correction-suggestions.js"></script>
    <script src="src/js/pantone-library-data.js"></script>
    <script src="src/js/color-library.js"></script>
    <script src="src/js/hd-integration.js"></script>
    
    <!-- Color Converter -->
    <script src="src/js/color-converter.js"></script>
    
    <!-- Main Calculator -->
    <script src="src/js/calculator.js"></script>
    
    <!-- Measurement History & Statistical Analysis -->
    <script src="src/js/measurement-history.js"></script>
    
    <!-- ChatGPT-5 UI Integration Script -->
    <script>
        // Enhanced UI Controller for ChatGPT-5 Design
        class HDStudioController {
            constructor() {
                this.state = {
                    hdFeaturesVisible: false,
                    currentTheme: 'light',
                    lastCalculationTime: null
                };
                
                this.init();
            }

            init() {
                console.log('HD CMYK Studio - ChatGPT-5 UI Loading...');
                this.setupEventListeners();
                this.setupColorInputs();
                this.setupRealTimeUpdates();
                this.initializeHDModules();
                this.updateStatus('HD CMYK Studio Ready');
            }

            initializeHDModules() {
                // Wait for HD modules to load, then integrate them
                setTimeout(() => {
                    this.integrateHDColorEngine();
                    this.integrateClientProfiles();
                    this.integrateICCProfiles();
                    this.integrateHeatmapVisualization();
                    this.integrateCSVEnhanced();
                    this.integrateSpectrophotometer();
                    this.updateStatus('All HD modules integrated successfully', 'success');
                }, 500);
            }

            integrateHDColorEngine() {
                if (window.hdColorEngine) {
                    console.log('HD Color Engine integrated');
                    // Configure HD Color Engine for extended gamut
                    window.hdColorEngine.setState({
                        extendedGamutEnabled: true,
                        activeSubstrate: 'hpw'
                    });
                }
            }

            integrateClientProfiles() {
                if (window.clientProfiles) {
                    console.log('Client Profiles integrated');
                    // Listen for profile changes
                    window.addEventListener('profileChanged', (e) => {
                        this.updateStatus(`Profile switched to: ${e.detail.profile.name}`, 'success');
                    });
                }
            }

            integrateICCProfiles() {
                if (window.iccProfileManager) {
                    console.log('ICC Profile Manager integrated');
                    // Listen for profile loading
                    window.addEventListener('iccProfileLoaded', (e) => {
                        this.updateStatus(`ICC Profile loaded: ${e.detail.filename}`, 'success');
                    });
                }
            }

            integrateHeatmapVisualization() {
                if (window.heatmapVisualization) {
                    console.log('Heatmap Visualization integrated');
                    const canvas = document.getElementById('heatmap-canvas');
                    if (canvas) {
                        // Initialize heatmap with canvas
                        this.heatmapInstance = window.heatmapVisualization.createHeatmap(canvas, {
                            showLabels: true,
                            colorScale: 'deltaE',
                            tolerance: 2.0
                        });
                    }
                }
            }

            integrateCSVEnhanced() {
                if (window.csvEnhanced) {
                    console.log('CSV Enhanced integrated');
                    // Setup CSV import handler
                    const csvInput = document.getElementById('csv-import');
                    if (csvInput) {
                        csvInput.addEventListener('change', (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                this.handleCSVImport(file);
                            }
                        });
                    }
                }
            }

            integrateSpectrophotometer() {
                if (window.SpectrophotometerIntegration && window.GridManager) {
                    console.log('Spectrophotometer Integration starting...');
                    
                    // Initialize grid manager first if not already done
                    if (!this.gridManager) {
                        const gridContainer = document.querySelector('.advanced-features') || document.querySelector('.container');
                        this.gridManager = new window.GridManager(gridContainer, {
                            defaultLayout: '6x8',
                            enableEditing: true,
                            enableHeatmap: true,
                            tolerance: 2.0,
                            autoCalculate: true
                        });
                    }
                    
                    // Initialize spectrophotometer integration
                    this.spectroIntegration = new window.SpectrophotometerIntegration(this.gridManager, {
                        monitorInterval: 2000,
                        autoIngest: true,
                        showNotifications: true,
                        maxFileSize: 10 * 1024 * 1024
                    });
                    
                    // Setup callbacks
                    this.spectroIntegration.setCallbacks({
                        onConnectionChange: (connected, folderName) => {
                            const status = connected ? `Connected to ${folderName}` : 'Disconnected from folder';
                            this.updateStatus(status, connected ? 'success' : 'info');
                        },
                        onFileDetected: (filenames) => {
                            this.updateStatus(`Detected ${filenames.length} new files`, 'info');
                        },
                        onFileProcessed: (filename, dataPoints) => {
                            this.updateStatus(`Processed ${filename}: ${dataPoints} data points`, 'success');
                        },
                        onError: (error) => {
                            this.updateStatus(`Spectrophotometer error: ${error}`, 'error');
                        }
                    });
                    
                    console.log('✅ Spectrophotometer Integration initialized');
                } else {
                    console.warn('⚠️ Spectrophotometer Integration or Grid Manager not available');
                }
            }

            setupEventListeners() {
                // Header controls
                document.getElementById('advanced-toggle')?.addEventListener('click', () => this.toggleAdvancedFeatures());
                document.getElementById('client-profile-btn')?.addEventListener('click', () => this.showClientProfiles());
                document.getElementById('icc-profile-btn')?.addEventListener('click', () => this.showICCProfiles());
                document.getElementById('theme-toggle')?.addEventListener('click', () => this.toggleTheme());

                // Calculate button
                document.getElementById('calculate-btn')?.addEventListener('click', () => this.performCalculation());

                // Modal controls
                document.getElementById('client-modal-close')?.addEventListener('click', () => this.closeModal('client-profile-modal'));
                document.getElementById('client-profile-modal')?.addEventListener('click', (e) => {
                    if (e.target.id === 'client-profile-modal') this.closeModal('client-profile-modal');
                });

                // HD Feature buttons
                document.getElementById('generate-grid')?.addEventListener('click', () => this.generateGrid());
                document.getElementById('clear-grid')?.addEventListener('click', () => this.clearGrid());
                document.getElementById('auto-balance')?.addEventListener('click', () => this.autoBalance());
                document.getElementById('compute-ccm')?.addEventListener('click', () => this.computeCCM());

                // Profile management
                document.getElementById('new-profile-btn')?.addEventListener('click', () => this.showProfileEditor());
                document.getElementById('save-profile')?.addEventListener('click', () => this.saveProfile());
                document.getElementById('cancel-profile-edit')?.addEventListener('click', () => this.hideProfileEditor());
                document.getElementById('delete-profile')?.addEventListener('click', () => this.deleteProfile());
            }

            setupColorInputs() {
                const colorInputs = [
                    'target-c', 'target-m', 'target-y', 'target-k',
                    'target-l', 'target-a', 'target-b',
                    'sample-c', 'sample-m', 'sample-y', 'sample-k',
                    'sample-l', 'sample-a', 'sample-b',
                    'target-o', 'target-g', 'target-v',
                    'sample-o', 'sample-g', 'sample-v'
                ];

                colorInputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('input', this.debounce(() => {
                            this.updateColorSwatch(inputId);
                            this.updateTAC();
                        }, 300));
                    }
                });
            }

            setupRealTimeUpdates() {
                // Update color swatches on load
                this.updateColorSwatch('target-c');
                this.updateColorSwatch('sample-c');
                this.updateTAC();
            }

            toggleAdvancedFeatures() {
                const features = document.getElementById('advanced-features');
                const toggleBtn = document.getElementById('advanced-toggle');
                
                if (features) {
                    this.state.hdFeaturesVisible = !this.state.hdFeaturesVisible;
                    features.classList.toggle('show', this.state.hdFeaturesVisible);
                    
                    // Show/hide extended gamut inputs
                    const extendedGamutSections = document.querySelectorAll('[id*="extended-gamut"]');
                    extendedGamutSections.forEach(section => {
                        section.style.display = this.state.hdFeaturesVisible ? 'block' : 'none';
                    });
                    
                    if (toggleBtn) {
                        toggleBtn.textContent = this.state.hdFeaturesVisible ? '🔬 Hide HD Features' : '🔬 HD Features';
                    }
                    
                    this.updateStatus(this.state.hdFeaturesVisible ? 'HD Features Enabled' : 'HD Features Disabled');
                }
            }

            performCalculation() {
                try {
                    const targetLAB = this.getLABValues('target');
                    const sampleLAB = this.getLABValues('sample');

                    if (!targetLAB || !sampleLAB) {
                        this.updateStatus('Missing LAB values for calculation', 'error');
                        return;
                    }

                    this.updateStatus('Calculating color difference...');

                    // Enhanced Delta E calculation
                    let deltaE = 0;
                    if (window.hdColorEngine) {
                        deltaE = window.hdColorEngine.calculateEnhancedDeltaE(targetLAB, sampleLAB, 'de2000');
                    } else if (window.colorScience) {
                        deltaE = window.colorScience.calculateDeltaE(targetLAB, sampleLAB);
                    } else {
                        deltaE = this.calculateBasicDeltaE(targetLAB, sampleLAB);
                    }

                    // Calculate component deltas
                    const deltaL = sampleLAB.l - targetLAB.l;
                    const deltaA = sampleLAB.a - targetLAB.a;
                    const deltaB = sampleLAB.b - targetLAB.b;
                    const deltaC = Math.sqrt(targetLAB.a * targetLAB.a + targetLAB.b * targetLAB.b) - 
                                   Math.sqrt(sampleLAB.a * sampleLAB.a + sampleLAB.b * sampleLAB.b);
                    const deltaH = Math.sqrt(deltaE * deltaE - deltaL * deltaL - deltaC * deltaC);

                    // Update displays
                    this.updateResults(deltaE, deltaL, deltaA, deltaB, deltaC, deltaH);
                    this.showResults();
                    this.updateStatus(`Calculation complete: ΔE = ${deltaE.toFixed(2)}`);

                    this.state.lastCalculationTime = new Date();

                } catch (error) {
                    console.error('Calculation error:', error);
                    this.updateStatus('Calculation failed', 'error');
                }
            }

            updateResults(deltaE, deltaL, deltaA, deltaB, deltaC, deltaH) {
                // Update main Delta E display
                const deltaEValue = document.getElementById('delta-e-value');
                if (deltaEValue) deltaEValue.textContent = deltaE.toFixed(2);

                // Update component deltas
                const components = { 'delta-l': deltaL, 'delta-a': deltaA, 'delta-b': deltaB, 'delta-c': deltaC, 'delta-h': deltaH };
                Object.entries(components).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) element.textContent = value.toFixed(2);
                });

                // Update tolerance indicator
                this.updateToleranceIndicator(deltaE);
            }

            updateToleranceIndicator(deltaE) {
                const indicator = document.getElementById('tolerance-indicator');
                if (!indicator) return;

                let className, text;
                if (deltaE <= 1.0) {
                    className = 'tolerance-excellent';
                    text = 'Excellent';
                } else if (deltaE <= 2.0) {
                    className = 'tolerance-good';
                    text = 'Good';
                } else if (deltaE <= 3.5) {
                    className = 'tolerance-good';
                    text = 'Acceptable';
                } else {
                    className = 'tolerance-poor';
                    text = 'Needs Adjustment';
                }

                indicator.className = `tolerance-indicator ${className}`;
                indicator.textContent = text;
            }

            showResults() {
                const resultsSection = document.getElementById('results-section');
                if (resultsSection) {
                    resultsSection.style.display = 'block';
                    resultsSection.scrollIntoView({ behavior: 'smooth' });
                }
            }

            updateColorSwatch(inputId) {
                const isTarget = inputId.startsWith('target');
                const swatchId = isTarget ? 'target-swatch' : 'sample-swatch';
                
                try {
                    const cmyk = this.getCMYKValues(isTarget ? 'target' : 'sample');
                    const rgb = window.colorScience ? 
                        window.colorScience.cmykToRgb(cmyk.c, cmyk.m, cmyk.y, cmyk.k) : 
                        { r: 128, g: 128, b: 128 };
                    
                    const swatch = document.getElementById(swatchId);
                    if (swatch) {
                        swatch.style.background = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                    }
                } catch (error) {
                    console.warn('Error updating color swatch:', error);
                }
            }

            updateTAC() {
                const targetCMYK = this.getCMYKValues('target');
                const sampleCMYK = this.getCMYKValues('sample');
                
                // Add extended gamut values if available
                const targetOGV = this.getOGVValues('target');
                const sampleOGV = this.getOGVValues('sample');
                
                const targetTAC = Object.values(targetCMYK).reduce((sum, val) => sum + val, 0) + 
                                  Object.values(targetOGV).reduce((sum, val) => sum + val, 0);
                const sampleTAC = Object.values(sampleCMYK).reduce((sum, val) => sum + val, 0) + 
                                  Object.values(sampleOGV).reduce((sum, val) => sum + val, 0);
                const maxTAC = Math.max(targetTAC, sampleTAC);
                
                const tacDisplay = document.getElementById('tac-value');
                if (tacDisplay) {
                    tacDisplay.textContent = `${maxTAC.toFixed(1)}%`;
                    tacDisplay.style.color = maxTAC > 320 ? '#ef4444' : '#3b82f6';
                }
            }

            showClientProfiles() {
                this.showModal('client-profile-modal');
                if (window.clientProfiles) {
                    this.populateClientProfiles();
                }
            }

            showICCProfiles() {
                this.updateStatus('ICC Profile management - Feature in development');
            }

            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) modal.style.display = 'block';
            }

            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) modal.style.display = 'none';
            }

            populateClientProfiles() {
                if (!window.clientProfiles) return;
                
                const select = document.getElementById('client-profile-select');
                if (select) {
                    const profiles = window.clientProfiles.getAllProfiles();
                    select.innerHTML = '<option value="">Select a profile...</option>';
                    profiles.forEach(profile => {
                        const option = document.createElement('option');
                        option.value = profile.name;
                        option.textContent = profile.name;
                        select.appendChild(option);
                    });
                }
            }

            showProfileEditor() {
                const editor = document.getElementById('profile-editor');
                if (editor) editor.style.display = 'block';
            }

            hideProfileEditor() {
                const editor = document.getElementById('profile-editor');
                if (editor) editor.style.display = 'none';
            }

            saveProfile() {
                // Profile saving logic would go here
                this.updateStatus('Profile saved successfully');
                this.hideProfileEditor();
            }

            deleteProfile() {
                if (confirm('Delete this profile?')) {
                    this.updateStatus('Profile deleted');
                    this.hideProfileEditor();
                }
            }

            generateGrid() {
                this.updateStatus('Generating color grid...');
                // Grid generation logic would integrate with heatmap module
            }

            clearGrid() {
                this.updateStatus('Grid cleared');
                const canvas = document.getElementById('heatmap-canvas');
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            }

            autoBalance() {
                this.updateStatus('Auto-balance in progress...');
                // Auto-balance logic would integrate with HD Color Engine
            }

            computeCCM() {
                this.updateStatus('Computing Color Correction Matrix...');
                const output = document.getElementById('ccm-matrix-output');
                if (output) {
                    output.textContent = 'CCM computation requires paired CSV files';
                }
            }

            toggleTheme() {
                // Theme toggle logic would go here
                this.updateStatus('Theme toggle - Feature in development');
            }

            updateStatus(message, type = 'info') {
                const statusBar = document.getElementById('status-text');
                if (statusBar) {
                    statusBar.textContent = message;
                    
                    // Add visual feedback based on type
                    const statusBarEl = document.getElementById('status-bar');
                    if (statusBarEl) {
                        statusBarEl.style.background = type === 'error' ? '#fef2f2' : 
                                                      type === 'success' ? '#f0fdf4' : 'white';
                        statusBarEl.style.color = type === 'error' ? '#dc2626' : 
                                                  type === 'success' ? '#16a34a' : '#374151';
                    }
                }
                
                console.log(`[HD Studio] ${message}`);
                
                // Auto-clear status after 5 seconds
                setTimeout(() => {
                    if (statusBar && statusBar.textContent === message) {
                        statusBar.textContent = 'Ready';
                        if (statusBarEl) {
                            statusBarEl.style.background = 'white';
                            statusBarEl.style.color = '#374151';
                        }
                    }
                }, 5000);
            }

            // Utility functions
            getLABValues(prefix) {
                const l = parseFloat(document.getElementById(`${prefix}-l`)?.value);
                const a = parseFloat(document.getElementById(`${prefix}-a`)?.value);
                const b = parseFloat(document.getElementById(`${prefix}-b`)?.value);
                
                if (isNaN(l) || isNaN(a) || isNaN(b)) return null;
                return { l, a, b };
            }

            getCMYKValues(prefix) {
                return {
                    c: parseFloat(document.getElementById(`${prefix}-c`)?.value) || 0,
                    m: parseFloat(document.getElementById(`${prefix}-m`)?.value) || 0,
                    y: parseFloat(document.getElementById(`${prefix}-y`)?.value) || 0,
                    k: parseFloat(document.getElementById(`${prefix}-k`)?.value) || 0
                };
            }

            getOGVValues(prefix) {
                return {
                    o: parseFloat(document.getElementById(`${prefix}-o`)?.value) || 0,
                    g: parseFloat(document.getElementById(`${prefix}-g`)?.value) || 0,
                    v: parseFloat(document.getElementById(`${prefix}-v`)?.value) || 0
                };
            }

            calculateBasicDeltaE(lab1, lab2) {
                const deltaL = lab2.l - lab1.l;
                const deltaA = lab2.a - lab1.a;
                const deltaB = lab2.b - lab1.b;
                return Math.sqrt(deltaL * deltaL + deltaA * deltaA + deltaB * deltaB);
            }

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // HD integration utility methods
            hasExtendedGamutValues(targetOGV, sampleOGV) {
                return (targetOGV.o > 0 || targetOGV.g > 0 || targetOGV.v > 0) ||
                       (sampleOGV.o > 0 || sampleOGV.g > 0 || sampleOGV.v > 0);
            }

            updateTACDisplay() {
                const targetCMYK = this.getCMYKValues('target');
                const sampleCMYK = this.getCMYKValues('sample');
                const targetOGV = this.getOGVValues('target');
                const sampleOGV = this.getOGVValues('sample');
                
                const targetTAC = Object.values({...targetCMYK, ...targetOGV}).reduce((sum, val) => sum + val, 0);
                const sampleTAC = Object.values({...sampleCMYK, ...sampleOGV}).reduce((sum, val) => sum + val, 0);
                const maxTAC = Math.max(targetTAC, sampleTAC);
                
                // Update TAC display if element exists
                const tacDisplay = document.getElementById('tac-value');
                if (tacDisplay) {
                    tacDisplay.textContent = `${maxTAC.toFixed(1)}%`;
                    tacDisplay.className = maxTAC > 400 ? 'tac-over-limit' : '';
                }
                
                console.log(`TAC: Target=${targetTAC.toFixed(1)}%, Sample=${sampleTAC.toFixed(1)}%`);
            }

            displayHDSuggestions(suggestions) {
                console.log('HD Color Suggestions:', suggestions);
                // This would update a suggestions display area in the UI
                this.updateStatus('HD color suggestions generated', 'success');
            }

            async handleCSVImport(file) {
                try {
                    this.updateStatus('Importing CSV file...');
                    
                    if (window.csvEnhanced) {
                        const result = await window.csvEnhanced.importCSVWithStreaming(file);
                        if (result.success) {
                            this.updateStatus(`CSV imported: ${result.data.length} records`, 'success');
                            
                            // Update heatmap if available
                            if (this.heatmapInstance) {
                                this.heatmapInstance.updateData(result.data);
                            }
                        } else {
                            this.updateStatus('CSV import failed', 'error');
                        }
                    } else {
                        this.updateStatus('CSV Enhanced module not available', 'error');
                    }
                } catch (error) {
                    console.error('CSV import error:', error);
                    this.updateStatus('CSV import failed', 'error');
                }
            }
        }

        // Initialize the HD Studio Controller when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            window.hdStudio = new HDStudioController();
            initializeMeasurementHistoryUI();
        });

        // Fallback initialization if DOM is already loaded
        if (document.readyState !== 'loading') {
            window.hdStudio = new HDStudioController();
            initializeMeasurementHistoryUI();
        }

        // Initialize Measurement History UI
        function initializeMeasurementHistoryUI() {
            console.log('Initializing Measurement History UI...');

            // Update quick stats display
            function updateQuickStats() {
                if (window.measurementHistory && window.measurementHistory.statistics) {
                    const stats = window.measurementHistory.statistics;
                    
                    document.getElementById('stat-median').textContent = stats.median || '--';
                    document.getElementById('stat-p95').textContent = stats.p95 || '--';
                    document.getElementById('stat-max').textContent = stats.max || '--';
                    document.getElementById('stat-count').textContent = stats.count || '--';
                    
                    const stabilityIndicator = document.getElementById('stability-indicator');
                    if (stats.stability) {
                        stabilityIndicator.textContent = stats.stability.level.toUpperCase();
                        stabilityIndicator.className = `stability-indicator ${stats.stability.level}`;
                    }
                    
                    document.getElementById('quick-stats-display').style.display = 'block';
                } else {
                    document.getElementById('quick-stats-display').style.display = 'none';
                }
            }

            // Show History Button
            document.getElementById('show-history-btn').addEventListener('click', () => {
                const modal = document.getElementById('measurement-history-modal');
                modal.style.display = 'block';
                
                // Create history table if not already created
                if (window.measurementHistory) {
                    window.measurementHistory.createHistoryTable('measurement-history-container', {
                        pageSize: 25,
                        showFilters: true,
                        showExport: true,
                        showStatistics: true
                    });
                }
            });

            // Export History Button
            document.getElementById('export-history-btn').addEventListener('click', () => {
                if (window.measurementHistory) {
                    // Show export options
                    const exportChoice = confirm('Export as CSV? (Cancel for JSON)');
                    if (exportChoice) {
                        window.measurementHistory.exportToCSV();
                    } else {
                        window.measurementHistory.exportToJSON();
                    }
                }
            });

            // Show Trend Chart Button
            document.getElementById('show-trend-chart-btn').addEventListener('click', () => {
                const modal = document.getElementById('trend-chart-modal');
                modal.style.display = 'block';
                
                // Create trend visualization
                if (window.measurementHistory) {
                    const visualization = window.measurementHistory.createVisualization('trend-chart-container');
                    if (visualization) {
                        visualization.updateVisualization();
                    }
                }
            });

            // Modal close handlers
            document.getElementById('history-modal-close').addEventListener('click', () => {
                document.getElementById('measurement-history-modal').style.display = 'none';
            });

            document.getElementById('trend-modal-close').addEventListener('click', () => {
                document.getElementById('trend-chart-modal').style.display = 'none';
            });

            // Close modals when clicking outside
            window.addEventListener('click', (event) => {
                const historyModal = document.getElementById('measurement-history-modal');
                const trendModal = document.getElementById('trend-chart-modal');
                
                if (event.target === historyModal) {
                    historyModal.style.display = 'none';
                }
                if (event.target === trendModal) {
                    trendModal.style.display = 'none';
                }
            });

            // Listen for measurement updates to refresh quick stats
            document.addEventListener('calculationComplete', () => {
                setTimeout(updateQuickStats, 100); // Small delay to ensure statistics are calculated
            });

            // Initial stats update
            setTimeout(updateQuickStats, 500);

            console.log('Measurement History UI initialized');
        }
    </script>

    <!-- HD Color Engine Modules -->
    <script src="src/js/color-science.js"></script>
    <script src="src/js/hd-color-engine.js"></script>
    <script src="src/js/csv-enhanced.js"></script>
    <script src="src/js/heatmap-visualization.js"></script>
    <script src="src/js/client-profiles.js"></script>
    <script src="src/js/icc-profile-manager.js"></script>
    <script src="src/js/hd-integration.js"></script>
    
    <!-- Advanced enhancement scripts -->
    <script src="src/js/toast-notifications.js"></script>
    <script src="src/js/debounced-input-handler.js"></script>
    <script src="src/js/keyboard-shortcuts.js"></script>
    <script src="src/js/accessibility-enhancements.js"></script>
    <script src="src/js/performance-optimizations.js"></script>
    <script src="src/js/enhancement-integration.js"></script>
    
    <!-- Integration and testing systems -->
    <script src="src/js/backward-compatibility.js"></script>
    <script src="src/js/state-synchronizer.js"></script>
    <script src="src/js/integration-manager.js"></script>
    <script src="src/js/integration-tests.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('PWA: HD CMYK Studio Service Worker registered', registration.scope);
                        
                        // Notify about HD modules loading
                        console.log('PWA: HD Color Engine modules loaded');
                        if (window.hdStudio) {
                            window.hdStudio.updateStatus('HD CMYK Studio loaded with advanced features', 'success');
                        }
                    })
                    .catch(error => {
                        console.log('PWA: Service Worker registration failed', error);
                    });
            });
        }
    </script>
</body>
</html>